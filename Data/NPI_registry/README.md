# NPI Provider Registry

Licensed health professionals in the United States are federally assigned a unique, persistent 10-digit identifier known as a National Provider Identifier, or "NPI". This information is stored in The National Plan and Provider Enumeration System (NPPES), along with additional location and provider type information. The registry is updated on a monthly basis and is avialable for public download. 

## Utility

The NPI registry is the only publicly-available dataset that hypothetically shows where all the country's dentists are located. This could be very useful for access mapping and counting the number of dentists in an area. There are drawbacks in how infrequently the inforamtion is updated by CMS -- anecdotally the information may not be refreshed once the address is initially collected. Also, the dataset only provides a single address per provider, which cannot indicate when a dentist practices at multiple sites.

### Questions this dataset could help answer

* What are the latitude and longitude coordinates of all periodontists in Texas?
* Which entities are assigned Type II NPIs in New Jersey?
* Which dental specialties are most common?
* Which dental access points do or do not participate in children's Medicaid (if data combined with InsureKidsNow data)

## Orientation & Stewardship  

The NPPES database is publicly accessible by a manual [single-provider search](https://npiregistry.cms.hhs.gov/), through a [small-batch API](https://npiregistry.cms.hhs.gov/registry/help-api), or a [full direct download](https://download.cms.gov/nppes/NPI_Files.html). The direct download is the best method to acquire public health data because the API will limit you to up to 1200 records. 

The direct download is updated monthly. It comes down as a ZIP file with 10 files inside. Working with the direct download can get unwieldy because the unzipped provider file is more than 7 gigabytes! So we quickly use our code to filter the file for only oral health providers. 

#### Citation
There does not appear to be any explicit citation preference outline on the CMS NPPES website.

#### Data use agreements
The NPI registry has no data use agreement. The file is available for download as is.

## Data Structure
The direct download from the NPPES gives us a table where each row is a unqie provider. To reflect how many types of specialties a provider can have, the table is formatted with many 'Provider Taxonomy' columns. We want to normalize the data so there is only one row for specialty. This means breaking the flat file into two tables: one for specialty (each row a unique provider-specialty relationship) and one for provider (each row a unique provider).

We also include our regular tables for data_ids so we can keep track of all the different datasets in our project. 

A LucidChart of the database diagram is available at this [link](https://www.lucidchart.com/invitations/accept/0a13c250-2d37-4f61-b270-54e804f04c49).

### specialty table
This table is generated by unpivoting all the provider taxonomy columns in the flat file into one specialty code column, which is then joined to a separate csv we have of all the dentist-specific taxonomy codes. There are 13 such codes:

|code | description |
| ------- | ------------|
| 122300000X	| Dentist |
| 1223D0001X	| Dental Public Health |
| 1223D0004X	| Dentist Anesthesiologist|
| 1223E0200X	| Endodontics |
| 1223G0001X	| General Practice |
| 1223P0106X	| Oral and Maxillofacial Pathology |
| 1223P0221X	| Pediatric Dentistry |
| 1223P0300X	| Periodontics |
| 1223P0700X	| Prosthodontics |
| 1223S0112X	| Oral and Maxillofacial Surgery |
| 1223X0008X	| Oral and Maxillofacial Radiology |
| 1223X0400X	| Orthodontics and Dentofacial Orthopedics |
| 1223X2210X	| Orofacial Pain |

Each row in this table reflects a unique provider-specialty relationship. A provider with multiple listed specialties will be on multiple lines.

### provider table
The provider table is structured much the same way as the original flat file, just with most of the unnecessary columns removed and filtered only for dentists (giving us a much smaller file). Most of the columns are renamed as well to be shorter and more manageable.

Three additional columns are added based on geocoding: FIPS_county_code, latitude, and longitude. These values are acquired through a call to the US Census geocoder.

## Issues & decisions
While the NPI registry is the most complete source of provider point-locations and gets refreshed on a monthly basis, the underlying records do not get refreshed frequently. It can be many years before locations are updated, if at all. Therefore we treat these addresses with caution. 

Another concern is the accuracy of the specialty coding systee. Provider self-identify their specialties on their NPI applications, which means a specialty code is not confirmed with licensing boards. If a dentist adds skills in a new specialty after applying for thier initial NPI, the new specialty is likely not inluded in the registry either.

## Modifications & External Connections
* Broke flat file into two tables
* Changed headings
* Dropped non-useful columns
* Changed date format
* Added long and lat (in progress)
* Added FIPS county code (in progress)
* Added text description for specialty code
* Removed non-dentists
* Added data_id (in progress)

## Code


## Project status
Positive Sum is building the geocoder that will retrieve the lat/long/FIPS fields. At that point data can be uploaded to the database.

## Tutorial
This section to be updated as tutorial walk-throughs are produced.
